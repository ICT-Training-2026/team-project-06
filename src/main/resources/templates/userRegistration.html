<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>Timinute</title>
  <link rel="stylesheet" th:href="@{/css/header.css}">
  <link rel="stylesheet" th:href="@{/css/userRegistration.css}">
</head>

<body>

  <header class="header">
    <div class="logo-container">
      <img th:src="@{/image/Timinute_logo.png}" alt="画像">
    </div>
    <div class="welcome-text">
      <p>お疲れ様です！<br>管理者さん</p>
    </div>
    <div class="buttons">
      <a href="/adminhome"><button class="headerbtn">HOME</button></a>
	  <form th:action="@{/logout}" method="post" style="display: inline;">
	  	<button class="headerbtn" type="submit">Logout</button>
	  </form>
    </div>
  </header>

  <registration class="registration">
    <h2>ユーザー登録</h2>
    <div class="record-box">
      <div class="department">
        <h3>部署</h3>
        <form>
          <label for="department"></label>
          <select id="department" name="department">
			<option value="1">営業</option>
			<option value="2">開発</option>
			<option value="0">総務</option>
          </select>
          <br><br>
        </form>
      </div>

      <div class="position">
        <h3>役職</h3>
        <form>
          <label for="department"></label>
          <select id="position" name="position">
			<option value="4">一般</option>
			<option value="3">係長</option>
			<option value="2">課長</option>
			<option value="1">部長</option>
			<option value="0">社長</option>
            
          </select>

          <br><br>
        </form>
      </div>
      <div class="EmployeeID">
        <h3>社員ID</h3>
        <form>
          <label for="EmployeeID"></label><br>
          <textarea id="employeeId" name="employeeId" rows="0" cols="6"></textarea><br><br>
        </form>
      </div>

      <div class="name">
        <h3>氏名</h3>
        <form>
          <label for="name"></label><br>
          <textarea id="name" name="name" rows="1" cols="20"></textarea><br><br>
        </form>
      </div>

      <div class="password">
        <h3>パスワード</h3>
        <form>
          <label for="password"></label><br>
          <textarea id="password" name="password" rows="1" cols="20"></textarea><br><br>
        </form>
      </div>
    </div>

    <div class="registration-buttons">
      <input type="submit" id="registerBtn" value="登録">
    </div>
  </registration>


  <script>
    // 既存社員ID（仮のデータ）
    const existingEmployeeIds = ['E001', 'E002', 'E003'];

	document.getElementById('registerBtn').addEventListener('click', function (e) {
	  e.preventDefault();

	  const employeeId = document.getElementById('employeeId').value.trim();
	  const name = document.getElementById('name').value.trim();
	  const password = document.getElementById('password').value.trim();
	  const department = document.querySelector('.department select').value;
	  const position = document.querySelector('.position select').value;

	  let errorMessages = [];

	  if (!employeeId) {
	    errorMessages.push('社員IDが入力されていません');
	  } else if (existingEmployeeIds.includes(employeeId)) {
	    errorMessages.push('社員IDが間違っています');
	  }

	  if (!name) {
	    errorMessages.push('氏名を入力してください');
	  }

	  if (!password) {
	    errorMessages.push('パスワードを入力してください');
	  } else if (password.length < 10 || password.length > 30) {
	    errorMessages.push('パスワード設定条件を満たしていません。10文字以上30文字以下で登録してください。');
	  }

	  if (errorMessages.length > 0) {
	    alert(errorMessages.join('\n'));
	    return;
	  }

	  // バリデーションOKなら送信データ作成
	  const data = {
		departmentId: department, 
	  	jobId: position,
	    employeeId: employeeId,
	    name: name,
	    password: password
	  };

	  // fetchでPOST送信
	  fetch('/userRegistrationer', {
	    method: 'POST',
	    headers: {
	      'Content-Type': 'application/json'
	    },
	    body: JSON.stringify(data)
	  })
	  .then(response => {
	    if (!response.ok) throw new Error('ネットワークエラー');
	    return response.text();
	  })
	  .then(data => {
	    console.log('Success:', data);
	    alert('登録が完了しました！');
	    window.location.href = '/userRegistration'; // 遷移できるように修正
	  })
	  .catch((error) => {
	    console.error('Error:', error);
	    alert('申請に失敗しました。もう一度お試しください。');
	  });
	});
  </script>

</body>

</html>