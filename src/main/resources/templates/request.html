<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">

<head>
    <meta charset="UTF-8">
    <title>Timinute</title>
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/request.css}">
</head>

<body>
    <header class="header">
        <div class="logo-container">
            <img th:src="@{/image/Timinute_logo.png}" alt="画像">
        </div>
        <div class="welcome-text">
            <p>
                お疲れ様です！<br>管理者さん
            </p>
        </div>
        <div class="buttons">
            <a href="/userhomepage"><button class="headerbtn">HOME</button></a>
			<form th:action="@{/logout}" method="post" style="display: inline;">
				<button class="headerbtn" type="submit">Logout</button>
			</form>
        </div>
    </header>

    <request class="request">
        <form id="applicationForm" th:action="@{/api/submit-request}" method="POST" th:object="${applicationForm}">
            <div class="attendance-category">
                <h2>勤怠区分</h2>
                <label> <input type="radio" th:field="*{categoryId}" value="2"> 振休 </label>
                <label> <input type="radio" th:field="*{categoryId}" value="3"> 年休 </label>
                <label> <input type="radio" th:field="*{categoryId}" value="5"> 欠勤 </label>
            </div>

            <div class="date">
                <h2>日付</h2>
                <label for="start-date">開始日:</label>
                <input type="date" id="start-date" th:field="*{startDate}">
                <p>~</p>
                <label for="end-date">終了日:</label>
                <input type="date" id="end-date" th:field="*{endDate}">
            </div>

            <div class="comment">
                <h2>コメント</h2>
                <label for="comment"></label><br>
                <textarea id="comment" th:field="*{comment}" rows="4" cols="50"></textarea>
                <br> <br>
            </div>

            <div class="request-buttons">
                <input type="button" value="申請" id="requestBtn">
            </div>
        </form>
    </request>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const submitButton = document.getElementById('requestBtn');
        const form = document.getElementById('applicationForm');

        submitButton.addEventListener('click', function (event) {
            event.preventDefault();

            const startDateInput = document.getElementById('start-date');
            const endDateInput = document.getElementById('end-date');
            const categoryInput = document.querySelector('input[name="categoryId"]:checked');
            const commentInput = document.getElementById('comment');

            if (!startDateInput.value || !endDateInput.value) {
                alert('日付を選択してください。');
                return;
            }

            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);

            if (startDate > endDate) {
                alert('開始日が終了日より後になっています。');
                return;
            }

            if (startDateInput.value && endDateInput.value && categoryInput) {
                alert('申請を送信します');
				const commentText = commentInput.value.trim();
				if (commentText.length > 50) {
				    alert('コメントは50文字以内で入力してください。');
				    return;
				}

                const formData = new FormData(form);

                fetch(form.action, {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(result => {
                    console.log('Success:', result);
                    alert(result);
                })
                .catch((error) => {
                    console.error('Error:', error);
                    alert('申請の送信中にエラーが発生しました。');
                });
            } else {
                alert('すべての必須項目を入力してください。');
            }
        });
    });
    </script>
</body>
</html>